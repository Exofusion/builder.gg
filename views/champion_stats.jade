doctype html
html
  head
    title= title
    
    include ./common_includes.jade

  body(ng-app='coreApp', ng-controller='buildStatsCtrl', class='ng-cloak')
    include ./navigation.jade

    #siteHeader.col-md-8
      h1 champion.builder.gg
      #headerSubText
        #randomSelect(class='noselect' ng-click='randomSearch()') How does {{random_tier}} build {{random_lane}} {{random_champion}}?

    #statSearchContainer
      .row
        .col-md-3
        .col-md-2
          ui-select(ng-model="search.tier.selected" theme="bootstrap" ng-disabled="disabled" class="tier_select" search-enabled="false" ng-init='search.tier.selected = tiers[4]')
            ui-select-match(placeholder="Select a tier")
              img(ng-src="{{$select.selected.image}}")
              {{$select.selected.name}}
            ui-select-choices(repeat="tier in tiers")
              .item-selection-choice
                img(ng-src="{{tier.image}}")
                span(ng-bind-html="tier.name")

        .col-md-2
          ui-select(ng-model="search.championId.selected" theme="bootstrap" ng-disabled="disabled" class="champion_select" search-enabled="true")
            ui-select-match(placeholder="Enter a champion")
              img(ng-src="{{$select.selected.image}}")
              {{$select.selected.name}}
            ui-select-choices(repeat="champion in champion_array | filter: $select.search")
              .item-selection-choice
                img(ng-src="{{champion.image}}")
                span(ng-bind-html="champion.name | highlight: $select.search")

        .col-md-2
          ui-select(ng-model="search.position.selected" theme="bootstrap" ng-disabled="disabled" class="position_select" search-enabled="false" ng-init="search.position.selected = positions[4]")
            ui-select-match(placeholder="Select a position")
              {{$select.selected}}
            ui-select-choices(repeat="position in positions")
              .item-selection-choice
                span(ng-bind-html="position")

      .row
        .col-md-5
        .col-md-2#searchSubmit
          div(class='btn btn-default' ng-show='!alert_loading' ng-click='submit()') Summon
          div(class='btn btn-default disabled' ng-show='alert_loading') <img id='loading_icon' src='/images/loading.svg'>
  
    #alertContainer
      div(class="alert alert-danger" ng-show="alert_error")
        <strong>Error:</strong> {{alert_error_message}}

    .row
      .col-md-3
      .col-md-6.genericContainer
        #kdaTitleContainer
          .kdaTitleKeyValueContainer(ng-show="current_stats")
            .kdaTitleValue {{current_champion.name}}
            .kdaTitleKey CHAMPION
          .kdaTitleKeyValueContainer(ng-show="current_stats")
            .kdaTitleValue {{tiers[current_tier-1].name}}
            .kdaTitleKey TIER
          .kdaTitleKeyValueContainer(ng-show="current_stats")
            .kdaTitleValue {{current_role}}
            .kdaTitleKey ROLE
          .kdaTitleKeyValueContainer(ng-show="current_stats")
            .kdaTitleValue {{current_lane}}
            .kdaTitleKey LANE
          .kdaTitleKeyValueContainer(ng-show="current_stats")
            .kdaTitleValue {{current_winrate}}%
            .kdaTitleKey WINRATE
          .kdaTitleKeyValueContainer(ng-show="current_stats")
            .kdaTitleValue {{current_patch}}
            .kdaTitleKey PATCH
        #kdaChartContainer
          canvas(id='kdaChart')
        div(bind-html-compile='kda_chart_legend')

    #kdaVictoryDefeat
      //div(class='btn btn-default' ng-show='previous_stats' ng-click='loadPrevious()') Load Previous
      div(class='btn btn-default' ng-disabled='!current_stats.victories' ng-click='parseStatCollection("victories")') Display Victories
      div(class='btn btn-default' ng-disabled='!current_stats.defeats' ng-click='parseStatCollection("defeats")') Display Defeats
      div(class='btn btn-default' ng-disabled='!current_stats' ng-click='parseStatCollection("all")') Display All Games

    include ./item_popover_template

    #startEndBuilds.genericContainer
      table(width="100%")
        thead
          tr
            th Start Build
            th Core Build
        tbody
          tr
            td(valign="top")
              span(ng-repeat="item in start_build.items track by $index")
                img(popover-template="itemPopover.templateUrl"
                    popover-trigger="mouseenter"
                    popover-title="{{itemPopover.item.name}} - {{itemPopover.item.gold.total}}g"
                    popover-animation="false"
                    ng-mouseover="itemPopover.item = itemlist_json[item]"
                    popover-append-to-body="true"
                    height="50px"
                    width="50px"
                    ng-src="{{getItemImage(item)}}")
              div {{Math.floor(100*(start_build.count/item_builds[0].samples))}}%
            td(valign="top")
              span(ng-repeat="item in core_build track by $index")
                img(popover-template="itemPopover.templateUrl"
                    popover-trigger="mouseenter"
                    popover-title="{{itemPopover.item.name}} - {{itemPopover.item.gold.total}}g"
                    popover-animation="false"
                    ng-mouseover="itemPopover.item = itemlist_json[item]"
                    popover-append-to-body="true"
                    height="50px"
                    width="50px"
                    ng-src="{{getItemImage(item)}}")
              #itemBuilderContainer
                button(class='btn btn-default'
                       ng-show='!item_builder_link && current_stats'
                       ng-click='getItemBuilderLink()') Get Item Builder Link
                a(href='{{item_builder_link}}' target='_blank')
                  button(class='btn btn-default'
                         ng-show='item_builder_link') Open Link
                input(class='form-control'
                      type='text'
                      ng-show='item_builder_link'
                      ng-model='item_builder_link_textbox')

    #minuteBuilds.genericContainer
      table(width="100%")
        thead
          tr
            th
            th(ng-repeat="n in getNumber(10) track by $index")
              div {{5+($index*5)}}:00
        tbody
          tr
            td Î” KDA
            td(ng-repeat="n in getNumber(10) track by $index")
              span {{item_builds[$index+1].samples ? current_kda_deltas[$index+1].toFixed(2) : ''}}
          tr
            td # Samples
            td(ng-repeat="n in getNumber(10) track by $index")
              span [{{item_builds[$index+1].samples ? item_builds[$index+1].samples : 0}}]
          tr#itemRow
            td
            td(valign="top" ng-repeat="frame in item_builds track by $index" ng-if="$index > 0 && $index < 11")
              span(ng-repeat="item in frame.significant_purchases")
                img(popover-template="itemPopover.templateUrl"
                    popover-trigger="mouseenter"
                    popover-title="{{itemPopover.item.name}} - {{itemPopover.item.gold.total}}g"
                    popover-animation="false"
                    ng-mouseover="itemPopover.item = itemlist_json[item.id]"
                    popover-append-to-body="true"
                    height="50px"
                    width="50px"
                    ng-src="{{getItemImage(item.id)}}")
                div {{item.popularity}}%
          tr
            td(ng-repeat="frame in item_builds track by $index" ng-if="$index > 0 && $index < 11")
              div(ng-repeat="item in item_builds[$index].item_count")
                img(height="30px" width="30px" ng-src="{{getItemImage(item.id)}}")
                span {{item.popularity}}%


    include ./analytics.jade